<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance API Playground</title>
    <style>
        :root {
            --bg-1: #f8fafc;
            --bg-2: #e0f2fe;
            --bg-3: #fef6e4;
            --card: #ffffff;
            --text: #0f172a;
            --muted: #475569;
            --accent: #0ea5e9;
            --accent-strong: #0f766e;
            --border: #e2e8f0;
            --danger: #dc2626;
            --shadow: 0 12px 35px rgba(15, 23, 42, 0.08);
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: "DM Sans", "Segoe UI", sans-serif;
            background: radial-gradient(circle at 20% 20%, var(--bg-2), var(--bg-1) 40%, var(--bg-3));
            color: var(--text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 20px 48px;
        }

        .hero {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            margin-bottom: 24px;
        }

        .eyebrow {
            letter-spacing: 0.06em;
            text-transform: uppercase;
            font-size: 12px;
            color: var(--muted);
            margin: 0 0 6px;
        }

        h1 {
            margin: 0 0 10px;
            font-size: 28px;
            letter-spacing: -0.01em;
        }

        .lede {
            margin: 0;
            color: var(--muted);
            max-width: 760px;
            line-height: 1.5;
        }

        .chip {
            padding: 10px 14px;
            background: rgba(14, 165, 233, 0.1);
            border: 1px solid rgba(14, 165, 233, 0.2);
            border-radius: 12px;
            color: var(--accent-strong);
            font-weight: 600;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            box-shadow: var(--shadow);
            padding: 18px 18px 14px;
        }

        .grid {
            display: grid;
            gap: 16px;
        }

        .grid.two {
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        }

        .grid.three {
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        }

        label {
            display: block;
            font-weight: 600;
            font-size: 13px;
            margin-bottom: 6px;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: #f8fafc;
            font-size: 14px;
            color: var(--text);
            outline: none;
            transition: border 0.15s ease, box-shadow 0.15s ease;
        }

        input:focus, select:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.15);
        }

        textarea {
            min-height: 90px;
            resize: vertical;
        }

        button {
            border: none;
            border-radius: 10px;
            padding: 10px 14px;
            font-weight: 700;
            cursor: pointer;
            color: #fff;
            background: linear-gradient(120deg, var(--accent), var(--accent-strong));
            box-shadow: 0 8px 18px rgba(14, 165, 233, 0.25);
            transition: transform 0.1s ease, box-shadow 0.1s ease;
        }

        button.secondary {
            background: #0f172a;
            box-shadow: 0 8px 18px rgba(15, 23, 42, 0.2);
        }

        button.danger {
            background: var(--danger);
            box-shadow: 0 8px 18px rgba(220, 38, 38, 0.25);
        }

        button:hover { transform: translateY(-1px); }
        button:active { transform: translateY(0); }

        .section-title {
            margin: 0 0 12px;
            font-size: 16px;
        }

        .muted {
            color: var(--muted);
            font-size: 13px;
            margin-top: 6px;
        }

        .inline {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .inline button {
            margin-top: 6px;
        }

        .pill {
            display: inline-flex;
            gap: 8px;
            align-items: center;
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(15, 118, 110, 0.1);
            color: var(--accent-strong);
            font-weight: 700;
            font-size: 12px;
        }

        .response {
            background: #0f172a;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 14px;
            font-family: "Berkeley Mono", "SFMono-Regular", Consolas, monospace;
            overflow: auto;
            max-height: 420px;
        }

        .response strong {
            color: #c7d2fe;
        }

        .row {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        }

        .stack {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .toolbar {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .tag {
            padding: 4px 8px;
            border-radius: 8px;
            background: rgba(15, 118, 110, 0.15);
            color: var(--accent-strong);
            font-weight: 700;
            font-size: 12px;
        }

        .tag.warn { background: rgba(220, 38, 38, 0.12); color: var(--danger); }
    </style>
</head>
<body>
<div class="container">
    <div class="hero">
        <div>
            <p class="eyebrow">Playground visual</p>
            <h1>Binance API Router</h1>
            <p class="lede">Dispare rapidamente as rotas expostas pelo PHP (General, Market, Account, Trading) sem precisar abrir o Insomnia. Preencha o básico e clique nos atalhos.</p>
        </div>
        <div class="chip">GET/POST/DELETE via fetch · Resposta em JSON</div>
    </div>

    <div class="card" style="margin-bottom: 18px;">
        <div class="toolbar">
            <h3 class="section-title">Configuração de sessão</h3>
            <span class="tag" id="statusTag">Pronto</span>
        </div>
        <div class="grid two">
            <div>
                <label for="baseUrl">Base URL</label>
                <input id="baseUrl" type="text" placeholder="http://localhost:8000" />
                <p class="muted">Use a origem onde o PHP está rodando (localhost:8000 por padrão).</p>
            </div>
            <div class="row">
                <div>
                    <label for="apiKey">API Key (opcional)</label>
                    <input id="apiKey" type="text" placeholder="Usa .env se vazio" />
                </div>
                <div>
                    <label for="secretKey">Secret Key (opcional)</label>
                    <input id="secretKey" type="password" placeholder="Usa .env se vazio" />
                </div>
            </div>
            <div class="row">
                <div>
                    <label for="basicUser">Basic Auth user</label>
                    <input id="basicUser" type="text" placeholder="Opcional" />
                </div>
                <div>
                    <label for="basicPass">Basic Auth password</label>
                    <input id="basicPass" type="password" placeholder="Opcional" />
                </div>
                <div>
                    <label for="correlationId">X-Correlation-Id</label>
                    <div class="inline">
                        <input id="correlationId" type="text" placeholder="Opcional" />
                        <button class="secondary" id="randomCorrelation" type="button">Gerar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid three" style="margin-bottom: 18px;">
        <div class="card">
            <h3 class="section-title">General</h3>
            <div class="inline">
                <button type="button" id="btnPing">Ping</button>
                <button type="button" id="btnTime" class="secondary">Hora</button>
            </div>
            <div class="stack" style="margin-top: 12px;">
                <label>Exchange info</label>
                <div class="row">
                    <input id="exchangeSymbol" type="text" placeholder="symbol (ex: BTCUSDT)" />
                    <input id="exchangeSymbols" type="text" placeholder='symbols (JSON) ex: ["BTCUSDT","ETHUSDT"]' />
                </div>
                <label class="inline" style="font-weight: 500;">
                    <input id="exchangeNoCache" type="checkbox" style="width:auto; margin-right:6px;" />
                    Ignorar cache nesta chamada
                </label>
                <button type="button" id="btnExchangeInfo">Buscar exchangeInfo</button>
            </div>
        </div>

        <div class="card">
            <h3 class="section-title">Market</h3>
            <div class="stack">
                <label for="tickerSymbol">Ticker</label>
                <div class="inline">
                    <input id="tickerSymbol" type="text" placeholder="BTCUSDT" />
                    <button type="button" id="btnTicker">Ver preço</button>
                </div>
            </div>
            <div class="stack" style="margin-top: 10px;">
                <label>Order book</label>
                <div class="row">
                    <input id="bookSymbol" type="text" placeholder="BTCUSDT" />
                    <input id="bookLimit" type="number" min="5" max="500" step="5" value="100" />
                </div>
                <button type="button" id="btnOrderBook">Obter depth</button>
            </div>
            <div class="stack" style="margin-top: 10px;">
                <label>Trades</label>
                <div class="row">
                    <input id="tradesSymbol" type="text" placeholder="BTCUSDT" />
                    <input id="tradesLimit" type="number" min="1" max="1000" step="50" value="500" />
                </div>
                <button type="button" id="btnTrades">Listar trades</button>
            </div>
        </div>

        <div class="card">
            <h3 class="section-title">Account</h3>
            <p class="muted">Se as chaves não forem preenchidas, o backend tenta usar o que estiver no .env.</p>
            <div class="stack">
                <button type="button" id="btnAccountInfo">Account info</button>
                <div class="row">
                    <input id="openSymbol" type="text" placeholder="symbol (opcional)" />
                    <button type="button" id="btnOpenOrders">Open orders</button>
                </div>
                <div class="row">
                    <input id="historySymbol" type="text" placeholder="symbol (obrigatório)" />
                    <input id="historyLimit" type="number" min="1" max="1000" value="500" />
                    <button type="button" id="btnOrderHistory">Order history</button>
                </div>
                <div class="row">
                    <input id="balanceAsset" type="text" placeholder="asset (ex: USDT)" />
                    <button type="button" id="btnBalance">Saldo do ativo</button>
                </div>
            </div>
        </div>
    </div>

    <div class="grid two" style="margin-bottom: 18px;">
        <div class="card">
            <h3 class="section-title">Trading · criar ordem</h3>
            <div class="row">
                <input id="orderSymbol" type="text" placeholder="symbol (ex: BTCUSDT)" />
                <select id="orderSide">
                    <option value="BUY">BUY</option>
                    <option value="SELL">SELL</option>
                </select>
                <select id="orderType">
                    <option value="LIMIT">LIMIT</option>
                    <option value="MARKET">MARKET</option>
                    <option value="STOP_LOSS">STOP_LOSS</option>
                    <option value="STOP_LOSS_LIMIT">STOP_LOSS_LIMIT</option>
                    <option value="TAKE_PROFIT">TAKE_PROFIT</option>
                    <option value="TAKE_PROFIT_LIMIT">TAKE_PROFIT_LIMIT</option>
                    <option value="LIMIT_MAKER">LIMIT_MAKER</option>
                </select>
            </div>
            <div class="row" style="margin-top: 8px;">
                <input id="orderQuantity" type="text" placeholder="quantity" />
                <input id="orderQuote" type="text" placeholder="quoteOrderQty (MARKET)" />
                <input id="orderPrice" type="text" placeholder="price (LIMIT/TP/SL)" />
                <input id="orderStop" type="text" placeholder="stopPrice (STOP/TAKE)" />
            </div>
            <div class="row" style="margin-top: 8px;">
                <select id="orderTif">
                    <option value="">timeInForce (opcional)</option>
                    <option value="GTC">GTC</option>
                    <option value="IOC">IOC</option>
                    <option value="FOK">FOK</option>
                </select>
            </div>
            <p class="muted">MARKET aceita quantity ou quoteOrderQty. LIMIT/TP/SL precisam de price. STOP/TAKE exigem stopPrice. LIMIT (exceto maker) aceita timeInForce.</p>
            <button type="button" id="btnCreateOrder">Enviar ordem</button>
        </div>

        <div class="card">
            <h3 class="section-title">Trading · cancelar ordem</h3>
            <div class="row">
                <input id="cancelSymbol" type="text" placeholder="symbol (ex: BTCUSDT)" />
                <input id="cancelOrderId" type="text" placeholder="orderId" />
            </div>
            <button type="button" class="danger" id="btnCancelOrder" style="margin-top: 10px;">Cancelar ordem</button>
            <p class="muted">Sempre envia api_key/secret_key (da sessão) no corpo.</p>
        </div>
    </div>

    <div class="card">
        <div class="toolbar">
            <h3 class="section-title">Resposta</h3>
            <div class="inline">
                <span class="pill" id="lastRequest">Nenhuma chamada ainda</span>
                <button type="button" class="secondary" id="btnClear">Limpar</button>
            </div>
        </div>
        <div class="response" id="responseBox">
            <pre id="responseContent">{\n  "hint": "As respostas aparecerão aqui."\n}</pre>
        </div>
    </div>
</div>

<script>
    const baseUrlInput = document.getElementById('baseUrl');
    const apiKeyInput = document.getElementById('apiKey');
    const secretKeyInput = document.getElementById('secretKey');
    const basicUserInput = document.getElementById('basicUser');
    const basicPassInput = document.getElementById('basicPass');
    const correlationInput = document.getElementById('correlationId');
    const statusTag = document.getElementById('statusTag');
    const lastRequest = document.getElementById('lastRequest');
    const responseContent = document.getElementById('responseContent');

    function defaultBase() {
        if (!baseUrlInput.value) {
            baseUrlInput.value = window.location.origin;
        }
    }

    function clean(obj) {
        return Object.fromEntries(
            Object.entries(obj)
                .filter(([, value]) => value !== undefined && value !== null && value !== '')
                .map(([key, value]) => [key, typeof value === 'string' ? value.trim() : value])
                .filter(([, value]) => value !== '')
        );
    }

    function buildHeaders(hasBody) {
        const headers = new Headers();
        if (hasBody) {
            headers.set('Content-Type', 'application/json');
        }

        const corr = correlationInput.value.trim();
        if (corr) {
            headers.set('X-Correlation-Id', corr);
        }

        const user = basicUserInput.value.trim();
        const pass = basicPassInput.value;
        if (user && pass) {
            headers.set('Authorization', 'Basic ' + btoa(user + ':' + pass));
        }

        return headers;
    }

    function formatBody(body) {
        return typeof body === 'string'
            ? body
            : JSON.stringify(body, null, 2);
    }

    async function request(method, path, { query = {}, body = null } = {}) {
        defaultBase();
        const base = baseUrlInput.value.replace(/\/$/, '');
        const url = new URL(path.replace(/^\//, ''), base + '/');

        const params = clean(query);
        Object.entries(params).forEach(([key, value]) => url.searchParams.set(key, value));

        const options = {
            method,
            headers: buildHeaders(body !== null)
        };

        if (body && (method === 'POST' || method === 'DELETE')) {
            options.body = JSON.stringify(body);
        }

        statusTag.textContent = 'Chamando...';
        statusTag.classList.remove('warn');

        try {
            const res = await fetch(url.toString(), options);
            const text = await res.text();
            let parsed;
            try {
                parsed = JSON.parse(text);
            } catch {
                parsed = text;
            }

            const payload = {
                method,
                url: url.toString(),
                status: res.status,
                headers: Object.fromEntries(res.headers.entries()),
                body: parsed
            };

            lastRequest.textContent = method + ' ' + url.pathname + (url.search || '');
            statusTag.textContent = res.ok ? '200 OK' : res.status + ' recebido';
            if (!res.ok) {
                statusTag.classList.add('warn');
            } else {
                statusTag.classList.remove('warn');
            }

            responseContent.textContent = formatBody(payload);
        } catch (error) {
            statusTag.textContent = 'Erro';
            statusTag.classList.add('warn');
            responseContent.textContent = JSON.stringify({ error: error.message }, null, 2);
        }
    }

    function withKeys(extra = {}) {
        return clean({
            api_key: apiKeyInput.value,
            secret_key: secretKeyInput.value,
            ...extra
        });
    }

    function normalizeSymbols(value) {
        if (!value) return undefined;
        try {
            const parsed = JSON.parse(value);
            return Array.isArray(parsed) ? JSON.stringify(parsed) : value;
        } catch {
            return value;
        }
    }

    document.getElementById('btnPing').addEventListener('click', () => {
        request('GET', '/api/general/ping');
    });

    document.getElementById('btnTime').addEventListener('click', () => {
        request('GET', '/api/general/time');
    });

    document.getElementById('btnExchangeInfo').addEventListener('click', () => {
        const symbol = document.getElementById('exchangeSymbol').value.trim();
        const symbolsRaw = document.getElementById('exchangeSymbols').value.trim();
        const noCache = document.getElementById('exchangeNoCache').checked;
        request('GET', '/api/general/exchange-info', {
            query: clean({
                symbol,
                symbols: normalizeSymbols(symbolsRaw),
                noCache: noCache ? 'true' : undefined
            })
        });
    });

    document.getElementById('btnTicker').addEventListener('click', () => {
        request('GET', '/api/market/ticker', {
            query: { symbol: document.getElementById('tickerSymbol').value }
        });
    });

    document.getElementById('btnOrderBook').addEventListener('click', () => {
        request('GET', '/api/market/order-book', {
            query: {
                symbol: document.getElementById('bookSymbol').value,
                limit: document.getElementById('bookLimit').value
            }
        });
    });

    document.getElementById('btnTrades').addEventListener('click', () => {
        request('GET', '/api/market/trades', {
            query: {
                symbol: document.getElementById('tradesSymbol').value,
                limit: document.getElementById('tradesLimit').value
            }
        });
    });

    document.getElementById('btnAccountInfo').addEventListener('click', () => {
        request('GET', '/api/account/info', { query: withKeys() });
    });

    document.getElementById('btnOpenOrders').addEventListener('click', () => {
        request('GET', '/api/account/open-orders', {
            query: withKeys({ symbol: document.getElementById('openSymbol').value })
        });
    });

    document.getElementById('btnOrderHistory').addEventListener('click', () => {
        request('GET', '/api/account/order-history', {
            query: withKeys({
                symbol: document.getElementById('historySymbol').value,
                limit: document.getElementById('historyLimit').value
            })
        });
    });

    document.getElementById('btnBalance').addEventListener('click', () => {
        request('GET', '/api/account/balance', {
            query: withKeys({ asset: document.getElementById('balanceAsset').value })
        });
    });

    document.getElementById('btnCreateOrder').addEventListener('click', () => {
        const payload = withKeys({
            symbol: document.getElementById('orderSymbol').value,
            side: document.getElementById('orderSide').value,
            type: document.getElementById('orderType').value,
            quantity: document.getElementById('orderQuantity').value,
            quoteOrderQty: document.getElementById('orderQuote').value,
            price: document.getElementById('orderPrice').value,
            stopPrice: document.getElementById('orderStop').value,
            timeInForce: document.getElementById('orderTif').value
        });
        request('POST', '/api/trading/create-order', { body: payload });
    });

    document.getElementById('btnCancelOrder').addEventListener('click', () => {
        const payload = withKeys({
            symbol: document.getElementById('cancelSymbol').value,
            orderId: document.getElementById('cancelOrderId').value
        });
        request('DELETE', '/api/trading/cancel-order', { body: payload });
    });

    document.getElementById('btnClear').addEventListener('click', () => {
        responseContent.textContent = '{\\n  "hint": "As respostas aparecerão aqui."\\n}';
        lastRequest.textContent = 'Nenhuma chamada ainda';
        statusTag.textContent = 'Pronto';
        statusTag.classList.remove('warn');
    });

    document.getElementById('randomCorrelation').addEventListener('click', () => {
        const random = crypto.randomUUID ? crypto.randomUUID() : Math.random().toString(36).slice(2, 10);
        correlationInput.value = random;
    });

    defaultBase();
</script>
</body>
</html>
